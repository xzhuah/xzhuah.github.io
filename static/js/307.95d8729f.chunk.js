"use strict";(self.webpackChunkmy_dimension_client=self.webpackChunkmy_dimension_client||[]).push([[307],{42307:(e,t,s)=>{s.r(t),s.d(t,{AiChatRoom:()=>ne,default:()=>oe});var r=s(65043),i=s(67807),n=s(30922),o=s(39336),a=s(94109),l=s(17392),d=s(82357),c=s(4598),u=s(81637),h=s(28079),g=s(34834),m=s(26033),f=s(21012),x=s(59685);const p={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.fI;return""!==e.role&&t.uint32(10).string(e.role),""!==e.model&&t.uint32(18).string(e.model),""!==e.message&&t.uint32(26).string(e.message),0!==e.createAt&&t.uint32(32).int64(e.createAt),t},decode(e,t){const s=e instanceof f.V5?e:new f.V5(e);let r=void 0===t?s.len:s.pos+t;const i={role:"",model:"",message:"",createAt:0};for(;s.pos<r;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;i.role=s.string();continue;case 2:if(18!==e)break;i.model=s.string();continue;case 3:if(26!==e)break;i.message=s.string();continue;case 4:if(32!==e)break;i.createAt=b(s.int64());continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return i},fromJSON:e=>({role:j(e.role)?globalThis.String(e.role):"",model:j(e.model)?globalThis.String(e.model):"",message:j(e.message)?globalThis.String(e.message):"",createAt:j(e.createAt)?globalThis.Number(e.createAt):0}),toJSON(e){const t={};return""!==e.role&&(t.role=e.role),""!==e.model&&(t.model=e.model),""!==e.message&&(t.message=e.message),0!==e.createAt&&(t.createAt=Math.round(e.createAt)),t},create:e=>p.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,r,i;const n={role:"",model:"",message:"",createAt:0};return n.role=null!==(t=e.role)&&void 0!==t?t:"",n.model=null!==(s=e.model)&&void 0!==s?s:"",n.message=null!==(r=e.message)&&void 0!==r?r:"",n.createAt=null!==(i=e.createAt)&&void 0!==i?i:0,n}};const A={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.fI;""!==e.threadId&&t.uint32(10).string(e.threadId),""!==e.title&&t.uint32(18).string(e.title),!1!==e.isPubic&&t.uint32(24).bool(e.isPubic),void 0!==e.owner&&x.Qg.encode(e.owner,t.uint32(34).fork()).join();for(const s of e.messages)p.encode(s,t.uint32(42).fork()).join();return 0!==e.lastModifiedAt&&t.uint32(48).int64(e.lastModifiedAt),t},decode(e,t){const s=e instanceof f.V5?e:new f.V5(e);let r=void 0===t?s.len:s.pos+t;const i={threadId:"",title:"",isPubic:!1,owner:void 0,messages:[],lastModifiedAt:0};for(;s.pos<r;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;i.threadId=s.string();continue;case 2:if(18!==e)break;i.title=s.string();continue;case 3:if(24!==e)break;i.isPubic=s.bool();continue;case 4:if(34!==e)break;i.owner=x.Qg.decode(s,s.uint32());continue;case 5:if(42!==e)break;i.messages.push(p.decode(s,s.uint32()));continue;case 6:if(48!==e)break;i.lastModifiedAt=b(s.int64());continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return i},fromJSON:e=>({threadId:j(e.threadId)?globalThis.String(e.threadId):"",title:j(e.title)?globalThis.String(e.title):"",isPubic:!!j(e.isPubic)&&globalThis.Boolean(e.isPubic),owner:j(e.owner)?x.Qg.fromJSON(e.owner):void 0,messages:globalThis.Array.isArray(null===e||void 0===e?void 0:e.messages)?e.messages.map((e=>p.fromJSON(e))):[],lastModifiedAt:j(e.lastModifiedAt)?globalThis.Number(e.lastModifiedAt):0}),toJSON(e){var t;const s={};return""!==e.threadId&&(s.threadId=e.threadId),""!==e.title&&(s.title=e.title),!1!==e.isPubic&&(s.isPubic=e.isPubic),void 0!==e.owner&&(s.owner=x.Qg.toJSON(e.owner)),null!==(t=e.messages)&&void 0!==t&&t.length&&(s.messages=e.messages.map((e=>p.toJSON(e)))),0!==e.lastModifiedAt&&(s.lastModifiedAt=Math.round(e.lastModifiedAt)),s},create:e=>A.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,r,i,n;const o={threadId:"",title:"",isPubic:!1,owner:void 0,messages:[],lastModifiedAt:0};return o.threadId=null!==(t=e.threadId)&&void 0!==t?t:"",o.title=null!==(s=e.title)&&void 0!==s?s:"",o.isPubic=null!==(r=e.isPubic)&&void 0!==r&&r,o.owner=void 0!==e.owner&&null!==e.owner?x.Qg.fromPartial(e.owner):void 0,o.messages=(null===(i=e.messages)||void 0===i?void 0:i.map((e=>p.fromPartial(e))))||[],o.lastModifiedAt=null!==(n=e.lastModifiedAt)&&void 0!==n?n:0,o}};const v={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.fI;void 0!==e.pageResult&&m.L0.encode(e.pageResult,t.uint32(10).fork()).join();for(const s of e.threads)A.encode(s,t.uint32(18).fork()).join();return t},decode(e,t){const s=e instanceof f.V5?e:new f.V5(e);let r=void 0===t?s.len:s.pos+t;const i={pageResult:void 0,threads:[]};for(;s.pos<r;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;i.pageResult=m.L0.decode(s,s.uint32());continue;case 2:if(18!==e)break;i.threads.push(A.decode(s,s.uint32()));continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return i},fromJSON:e=>({pageResult:j(e.pageResult)?m.L0.fromJSON(e.pageResult):void 0,threads:globalThis.Array.isArray(null===e||void 0===e?void 0:e.threads)?e.threads.map((e=>A.fromJSON(e))):[]}),toJSON(e){var t;const s={};return void 0!==e.pageResult&&(s.pageResult=m.L0.toJSON(e.pageResult)),null!==(t=e.threads)&&void 0!==t&&t.length&&(s.threads=e.threads.map((e=>A.toJSON(e)))),s},create:e=>v.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t;const s={pageResult:void 0,threads:[]};return s.pageResult=void 0!==e.pageResult&&null!==e.pageResult?m.L0.fromPartial(e.pageResult):void 0,s.threads=(null===(t=e.threads)||void 0===t?void 0:t.map((e=>A.fromPartial(e))))||[],s}};const w={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.fI;return""!==e.message&&t.uint32(10).string(e.message),""!==e.model&&t.uint32(18).string(e.model),""!==e.threadId&&t.uint32(26).string(e.threadId),t},decode(e,t){const s=e instanceof f.V5?e:new f.V5(e);let r=void 0===t?s.len:s.pos+t;const i={message:"",model:"",threadId:""};for(;s.pos<r;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;i.message=s.string();continue;case 2:if(18!==e)break;i.model=s.string();continue;case 3:if(26!==e)break;i.threadId=s.string();continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return i},fromJSON:e=>({message:j(e.message)?globalThis.String(e.message):"",model:j(e.model)?globalThis.String(e.model):"",threadId:j(e.threadId)?globalThis.String(e.threadId):""}),toJSON(e){const t={};return""!==e.message&&(t.message=e.message),""!==e.model&&(t.model=e.model),""!==e.threadId&&(t.threadId=e.threadId),t},create:e=>w.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,r;const i={message:"",model:"",threadId:""};return i.message=null!==(t=e.message)&&void 0!==t?t:"",i.model=null!==(s=e.model)&&void 0!==s?s:"",i.threadId=null!==(r=e.threadId)&&void 0!==r?r:"",i}};function b(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function j(e){return null!==e&&void 0!==e}const k="/api/v0/ai/chat",I=(e,t)=>{const s=m.K3.fromJSON({page:e,pageSize:t});return(0,g.wN)(k+"/getThreadProfile",m.K3,v,s)},S=(e,t,s)=>{const r=w.fromJSON({message:e,threadId:t,model:s});return(0,g.wN)(k+"/talk_sync",w,p,r)};var N=s(70141),P=s(44843),R=s(95874),y=s(68746),C=s(87332),T=s(74117),E=s(94516),M=s(81045),O=s(64442),J=s(14149),_=s(56454),V=s(20285),L=s(53596),G=s(70322),F=s(67823),D=s(13450),Q=s(70579);const X=e=>(0,Q.jsx)("a",{target:"_blank",href:e.href,children:e.children}),H=e=>{let{children:t,sx:s,...r}=e;return(0,Q.jsx)(E.A,{sx:{...s},...r,children:(0,Q.jsx)(_.o,{components:{a:X},remarkPlugins:[V.A,F.A,L.A],rehypePlugins:[G.A,[D.A,{detect:!1,ignoreMissing:!0}]],children:t})})};var K=s(36910),Y=s(75270),B=s.n(Y);const $=e=>{let{text:t,icon:s=(0,Q.jsx)(K.A,{}),...r}=e;return(0,Q.jsx)(l.A,{onClick:()=>B()(t instanceof Function?t():t),...r,children:s})},z=r.memo($),W=e=>{let{record:t,sx:s,...r}=e;return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)(i.A,{direction:"row",paddingY:2,maxWidth:"100%",sx:{...s},...r,children:[(0,Q.jsx)(E.A,{marginTop:1,children:"assistant"===t.role?(0,Q.jsx)(M.A,{sx:{bgcolor:"primary.main"},style:{backgroundColor:"#e4a710"},children:(0,Q.jsx)(O.A,{})}):(0,Q.jsx)(M.A,{sx:{bgcolor:"primary.main"},children:(0,Q.jsx)(J.A,{})})}),(0,Q.jsxs)(i.A,{direction:"column",marginX:4,textAlign:"start",children:[(0,Q.jsxs)(h.o5,{variant:"caption",children:[new Date(t.createAt).toLocaleString()," ","assistant"===t.role?`(${t.model})`:""]}),(0,Q.jsxs)(i.A,{direction:"row",flexGrow:1,textAlign:"start",children:[(0,Q.jsx)(H,{children:t.message}),(0,Q.jsx)(z,{sx:{alignSelf:"flex-start",marginTop:1},text:r.children})]})]})]}),(0,Q.jsx)(o.A,{sx:{width:"100%"}})]})},q=r.memo(W);var Z=s(35475),U=s(99820),ee=s(17481);const te=e=>{let{profile:t,...s}=e;return(0,Q.jsxs)(h.Dr,{sx:{width:"100%",textAlign:"start",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",minHeight:"2rem"},...s,children:[" ",(0,Q.jsx)(h.Zq,{enableTranslate:!1,children:t.title})]},t.threadId)};var se=s(29479),re=s(88786);const ie=["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo","gpt-3.5-turbo-16k"],ne=()=>{const{t:e}=(0,T.Bd)(),[t,s]=r.useState(""),{showAlert:m}=r.useContext(ee.A),[f,x]=(0,Z.ok)(),v=f.get("id"),[w,b]=r.useState([]),[j,E]=r.useState(!1),[M,O]=r.useState(ie[0]),[J,_]=r.useState([]),[V,L]=r.useState(0),[G,F]=r.useState(0),[D,X]=r.useState(!1),[H,K]=r.useState(!1),Y=(0,r.useRef)(null),B=(0,r.useRef)(null);(0,r.useEffect)((()=>{var e;j||(null===(e=B.current)||void 0===e||e.focus())}),[j]),(0,r.useEffect)((()=>{I(G,10).then((e=>{_(e.threads),e.pageResult&&L(e.pageResult.totalPage-1)})).catch((e=>{m(e.message,"error")}))}),[]),(0,r.useEffect)((()=>{v?(e=>(0,g.Hd)(k+"/getChatThread",A,e))(v).then((e=>{e&&(b(e.messages),K(e.isPubic))})).catch((e=>{m("Chat not found","error"),x({}),(0,P.yy)(e)})):b([])}),[f]),(0,r.useEffect)((()=>{var e;null===(e=Y.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),[w]);const $=()=>{G<V&&I(G+1,10).then((e=>{_([...J,...e.threads]),F(G+1),e.pageResult&&L(e.pageResult.totalPage-1)})).catch((e=>{m(e.message,"error")}))},z=()=>{if(""===t)return;E(!0);const e=p.create();e.message=t,e.role="user",e.createAt=Date.now(),b((t=>[...t,e])),v?S(t,v,M).then((e=>{b((t=>[...t,e])),E(!1),s("")})):(0,g.y1)(k+"/newChatThread").then((e=>{const r=e;S(t,e,M).then((e=>{b((t=>[...t,e])),x({id:r}),E(!1),s("")}))}))},W=(0,r.useCallback)((async e=>{"Enter"===e.key&&(e.ctrlKey||e.shiftKey)&&(e.preventDefault(),z())}),[t]);return(0,r.useEffect)((()=>(window.addEventListener("keydown",W),()=>{window.removeEventListener("keydown",W)})),[W]),(0,Q.jsxs)(i.A,{direction:"row",justifyContent:"start",alignItems:"start",spacing:0,width:"100%",height:"89dvh",children:[(0,Q.jsx)(U.A,{up:"md",children:(0,Q.jsxs)(i.A,{direction:"column",alignItems:"flex-start",height:"100%",width:"20%",minWidth:"250px",spacing:0,sx:{paddingX:"5px",overflowY:"auto",textOverflow:"ellipsis",backgroundColor:"#f1f1f1",borderRadius:"5px"},children:[(0,Q.jsx)(i.A,{direction:"row",justifyContent:"center",width:"100%",paddingTop:2,children:(0,Q.jsx)(h.o5,{variant:"h6",children:"Chat History"})}),(0,Q.jsx)(n.A,{dense:!0,sx:{width:"100%"},children:(0,Q.jsx)(se.A,{data:J,renderItem:e=>(0,Q.jsxs)(i.A,{direction:"column",children:[(0,Q.jsx)(te,{profile:e,onClick:()=>{x({id:e.threadId})}},e.threadId),(0,Q.jsx)(o.A,{})]},e.threadId)})}),G<V&&(0,Q.jsx)(h.$n,{onClick:$,children:"Load More"})]})}),(0,Q.jsx)(U.A,{down:"md",children:(0,Q.jsx)(a.Ay,{anchor:"left",open:D,onClose:()=>X(!1),className:"blurDialog",children:(0,Q.jsxs)(i.A,{direction:"column",alignItems:"flex-start",width:"70dvw",spacing:0,sx:{padding:"20px",overflowY:"auto",textOverflow:"ellipsis"},children:[(0,Q.jsxs)(i.A,{direction:"row",justifyContent:"center",width:"100%",children:[(0,Q.jsx)(h.o5,{variant:"h6",flexGrow:1,children:"Chat History"}),(0,Q.jsx)(l.A,{sx:{marginRight:"8px"},onClick:()=>{X(!1)},children:(0,Q.jsx)(C.A,{})})]}),(0,Q.jsx)(se.A,{data:[...J],renderItem:e=>(0,Q.jsxs)(i.A,{direction:"column",width:"100%",children:[(0,Q.jsx)(te,{profile:e,onClick:()=>{x({id:e.threadId}),X(!1)}}),(0,Q.jsx)(o.A,{})]},e.threadId)}),G<V&&(0,Q.jsx)(h.$n,{onClick:$,children:"Load More"})]})})}),(0,Q.jsxs)(i.A,{direction:"column",alignItems:"flex-start",sx:{width:{xs:"100%",md:"85%"},height:"100%"},children:[(0,Q.jsxs)(i.A,{direction:"row",justifyContent:"start",alignItems:"center",width:"100%",spacing:2,children:[(0,Q.jsx)(U.A,{down:"md",children:(0,Q.jsx)(l.A,{"aria-label":"menu",onClick:()=>{X(!0)},sx:{justifySelf:"flex-start"},children:(0,Q.jsx)(y.A,{})})}),(0,Q.jsx)(d.A,{options:ie,sx:{flexGrow:1},value:M,onChange:(e,t)=>O(t),renderInput:t=>(0,Q.jsx)(h.A_,{...t,label:e("Model")})}),null!==v&&v.length>0&&(0,Q.jsx)(h.ip,{control:(0,Q.jsx)(c.A,{checked:H,onChange:e=>{const t=e.target.checked;((e,t)=>e?(0,g.y1)(k+"/make_public",t):(0,g.y1)(k+"/make_private",t))(t,v).then((e=>{K(t),t&&m("You can send the link of this chat to other people to let them join this chat!","success")})).catch((e=>{m(e.message,"error")}))}}),label:"Sharing"}),(0,Q.jsx)(l.A,{onClick:()=>{var e;x({}),b([]),F(0),I(0,10).then((e=>{_(e.threads),e.pageResult&&L(e.pageResult.totalPage-1)})).catch((e=>{m(e.message,"error")})),null===(e=B.current)||void 0===e||e.focus()},children:(0,Q.jsx)(N.A,{})})]}),(0,Q.jsxs)(i.A,{direction:"column",alignItems:"flex-start",flexGrow:1,sx:{width:"100%"},overflow:"auto",textOverflow:"ellipsis",className:"hideScrollBar",children:[(0,Q.jsx)(se.A,{data:w,renderItem:(e,t)=>(0,Q.jsx)(q,{record:e,paddingX:2},t)}),(0,Q.jsx)("div",{ref:Y})]}),(0,Q.jsx)(i.A,{direction:"row",width:"100%",justifyContent:"center",alignItems:"flex-end",spacing:2,children:(0,Q.jsx)(re.A,{minRows:3,value:t,inputSlotProps:{sx:{borderRadius:"0px"}},style:{borderRadius:"0px"},onChange:e=>{s(e.target.value)},placeholder:e("Ctrl + Enter to Send a message"),children:(0,Q.jsx)(l.A,{disabled:0===t.length||j,onClick:z,children:j?(0,Q.jsx)(u.A,{size:24}):(0,Q.jsx)(R.A,{})})})})]})]})},oe=r.memo(ne)}}]);
//# sourceMappingURL=307.95d8729f.chunk.js.map