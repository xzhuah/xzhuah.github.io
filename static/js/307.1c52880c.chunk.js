"use strict";(self.webpackChunkmy_dimension_client=self.webpackChunkmy_dimension_client||[]).push([[307],{2307:(e,t,s)=>{s.r(t),s.d(t,{AiChatRoom:()=>oe,default:()=>ae});var i=s(5043),r=s(7807),n=s(75),o=s(9336),a=s(4109),l=s(7392),d=s(6222),c=s(4598),u=s(3300),h=s(4834),g=s(6033),m=s(1012),f=s(9685);const x={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.fI;return""!==e.role&&t.uint32(10).string(e.role),""!==e.model&&t.uint32(18).string(e.model),""!==e.message&&t.uint32(26).string(e.message),0!==e.createAt&&t.uint32(32).int64(e.createAt),t},decode(e,t){const s=e instanceof m.V5?e:new m.V5(e);let i=void 0===t?s.len:s.pos+t;const r={role:"",model:"",message:"",createAt:0};for(;s.pos<i;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;r.role=s.string();continue;case 2:if(18!==e)break;r.model=s.string();continue;case 3:if(26!==e)break;r.message=s.string();continue;case 4:if(32!==e)break;r.createAt=w(s.int64());continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return r},fromJSON:e=>({role:b(e.role)?globalThis.String(e.role):"",model:b(e.model)?globalThis.String(e.model):"",message:b(e.message)?globalThis.String(e.message):"",createAt:b(e.createAt)?globalThis.Number(e.createAt):0}),toJSON(e){const t={};return""!==e.role&&(t.role=e.role),""!==e.model&&(t.model=e.model),""!==e.message&&(t.message=e.message),0!==e.createAt&&(t.createAt=Math.round(e.createAt)),t},create:e=>x.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,i,r;const n={role:"",model:"",message:"",createAt:0};return n.role=null!==(t=e.role)&&void 0!==t?t:"",n.model=null!==(s=e.model)&&void 0!==s?s:"",n.message=null!==(i=e.message)&&void 0!==i?i:"",n.createAt=null!==(r=e.createAt)&&void 0!==r?r:0,n}};const p={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.fI;""!==e.threadId&&t.uint32(10).string(e.threadId),""!==e.title&&t.uint32(18).string(e.title),!1!==e.isPubic&&t.uint32(24).bool(e.isPubic),void 0!==e.owner&&f.Qg.encode(e.owner,t.uint32(34).fork()).join();for(const s of e.messages)x.encode(s,t.uint32(42).fork()).join();return 0!==e.lastModifiedAt&&t.uint32(48).int64(e.lastModifiedAt),t},decode(e,t){const s=e instanceof m.V5?e:new m.V5(e);let i=void 0===t?s.len:s.pos+t;const r={threadId:"",title:"",isPubic:!1,owner:void 0,messages:[],lastModifiedAt:0};for(;s.pos<i;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;r.threadId=s.string();continue;case 2:if(18!==e)break;r.title=s.string();continue;case 3:if(24!==e)break;r.isPubic=s.bool();continue;case 4:if(34!==e)break;r.owner=f.Qg.decode(s,s.uint32());continue;case 5:if(42!==e)break;r.messages.push(x.decode(s,s.uint32()));continue;case 6:if(48!==e)break;r.lastModifiedAt=w(s.int64());continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return r},fromJSON:e=>({threadId:b(e.threadId)?globalThis.String(e.threadId):"",title:b(e.title)?globalThis.String(e.title):"",isPubic:!!b(e.isPubic)&&globalThis.Boolean(e.isPubic),owner:b(e.owner)?f.Qg.fromJSON(e.owner):void 0,messages:globalThis.Array.isArray(null===e||void 0===e?void 0:e.messages)?e.messages.map((e=>x.fromJSON(e))):[],lastModifiedAt:b(e.lastModifiedAt)?globalThis.Number(e.lastModifiedAt):0}),toJSON(e){var t;const s={};return""!==e.threadId&&(s.threadId=e.threadId),""!==e.title&&(s.title=e.title),!1!==e.isPubic&&(s.isPubic=e.isPubic),void 0!==e.owner&&(s.owner=f.Qg.toJSON(e.owner)),null!==(t=e.messages)&&void 0!==t&&t.length&&(s.messages=e.messages.map((e=>x.toJSON(e)))),0!==e.lastModifiedAt&&(s.lastModifiedAt=Math.round(e.lastModifiedAt)),s},create:e=>p.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,i,r,n;const o={threadId:"",title:"",isPubic:!1,owner:void 0,messages:[],lastModifiedAt:0};return o.threadId=null!==(t=e.threadId)&&void 0!==t?t:"",o.title=null!==(s=e.title)&&void 0!==s?s:"",o.isPubic=null!==(i=e.isPubic)&&void 0!==i&&i,o.owner=void 0!==e.owner&&null!==e.owner?f.Qg.fromPartial(e.owner):void 0,o.messages=(null===(r=e.messages)||void 0===r?void 0:r.map((e=>x.fromPartial(e))))||[],o.lastModifiedAt=null!==(n=e.lastModifiedAt)&&void 0!==n?n:0,o}};const v={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.fI;void 0!==e.pageResult&&g.L0.encode(e.pageResult,t.uint32(10).fork()).join();for(const s of e.threads)p.encode(s,t.uint32(18).fork()).join();return t},decode(e,t){const s=e instanceof m.V5?e:new m.V5(e);let i=void 0===t?s.len:s.pos+t;const r={pageResult:void 0,threads:[]};for(;s.pos<i;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;r.pageResult=g.L0.decode(s,s.uint32());continue;case 2:if(18!==e)break;r.threads.push(p.decode(s,s.uint32()));continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return r},fromJSON:e=>({pageResult:b(e.pageResult)?g.L0.fromJSON(e.pageResult):void 0,threads:globalThis.Array.isArray(null===e||void 0===e?void 0:e.threads)?e.threads.map((e=>p.fromJSON(e))):[]}),toJSON(e){var t;const s={};return void 0!==e.pageResult&&(s.pageResult=g.L0.toJSON(e.pageResult)),null!==(t=e.threads)&&void 0!==t&&t.length&&(s.threads=e.threads.map((e=>p.toJSON(e)))),s},create:e=>v.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t;const s={pageResult:void 0,threads:[]};return s.pageResult=void 0!==e.pageResult&&null!==e.pageResult?g.L0.fromPartial(e.pageResult):void 0,s.threads=(null===(t=e.threads)||void 0===t?void 0:t.map((e=>p.fromPartial(e))))||[],s}};const A={encode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m.fI;return""!==e.message&&t.uint32(10).string(e.message),""!==e.model&&t.uint32(18).string(e.model),""!==e.threadId&&t.uint32(26).string(e.threadId),t},decode(e,t){const s=e instanceof m.V5?e:new m.V5(e);let i=void 0===t?s.len:s.pos+t;const r={message:"",model:"",threadId:""};for(;s.pos<i;){const e=s.uint32();switch(e>>>3){case 1:if(10!==e)break;r.message=s.string();continue;case 2:if(18!==e)break;r.model=s.string();continue;case 3:if(26!==e)break;r.threadId=s.string();continue}if(4===(7&e)||0===e)break;s.skip(7&e)}return r},fromJSON:e=>({message:b(e.message)?globalThis.String(e.message):"",model:b(e.model)?globalThis.String(e.model):"",threadId:b(e.threadId)?globalThis.String(e.threadId):""}),toJSON(e){const t={};return""!==e.message&&(t.message=e.message),""!==e.model&&(t.model=e.model),""!==e.threadId&&(t.threadId=e.threadId),t},create:e=>A.fromPartial(null!==e&&void 0!==e?e:{}),fromPartial(e){var t,s,i;const r={message:"",model:"",threadId:""};return r.message=null!==(t=e.message)&&void 0!==t?t:"",r.model=null!==(s=e.model)&&void 0!==s?s:"",r.threadId=null!==(i=e.threadId)&&void 0!==i?i:"",r}};function w(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function b(e){return null!==e&&void 0!==e}const j="/api/v0/ai/chat",k=(e,t)=>{const s=g.K3.fromJSON({page:e,pageSize:t});return(0,h.wN)(j+"/getThreadProfile",g.K3,v,s)},I=function(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=A.fromJSON({message:e,threadId:t,model:s});return i?(0,h.wN)(j+"/talk_sync",A,x,r):(0,h.nD)(j+"/talk",A,r)};var S=s(141),N=s(4843),y=s(2966),P=s(5201),R=s(5874),T=s(8746),C=s(7332),M=s(4117),E=s(2135),O=s(1045),J=s(4442),_=s(4149),V=s(6454),L=s(285),D=s(3596),G=s(322),F=s(7823),Q=s(3450),X=s(579);const H=e=>(0,X.jsx)("a",{target:"_blank",href:e.href,children:e.children}),K=e=>{let{children:t,sx:s,...i}=e;return(0,X.jsx)(E.A,{sx:{...s},...i,children:(0,X.jsx)(V.o,{components:{a:H},remarkPlugins:[L.A,F.A,D.A],rehypePlugins:[G.A,[Q.A,{detect:!1,ignoreMissing:!0}]],children:t})})};var Y=s(6910),B=s(5270),$=s.n(B);const W=e=>{let{text:t,icon:s=(0,X.jsx)(Y.A,{}),...i}=e;return(0,X.jsx)(l.A,{onClick:()=>$()(t instanceof Function?t():t),...i,children:s})},q=i.memo(W),z=e=>{let{record:t,sx:s,...i}=e;return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(r.A,{direction:"row",paddingY:2,maxWidth:"100%",sx:{...s},...i,children:[(0,X.jsx)(E.A,{marginTop:1,children:"assistant"===t.role?(0,X.jsx)(O.A,{sx:{bgcolor:"primary.main"},style:{backgroundColor:"#e4a710"},children:(0,X.jsx)(J.A,{})}):(0,X.jsx)(O.A,{sx:{bgcolor:"primary.main"},children:(0,X.jsx)(_.A,{})})}),(0,X.jsxs)(r.A,{direction:"column",marginX:4,textAlign:"start",children:[(0,X.jsxs)(u.o5,{variant:"caption",children:[new Date(t.createAt).toLocaleString()," ","assistant"===t.role?`(${t.model})`:""]}),(0,X.jsxs)(r.A,{direction:"row",flexGrow:1,textAlign:"start",children:[(0,X.jsx)(K,{children:t.message}),(0,X.jsx)(q,{sx:{alignSelf:"flex-start",marginTop:1},text:i.children})]})]})]}),(0,X.jsx)(o.A,{sx:{width:"100%"}})]})},Z=i.memo(z);var U=s(5475),ee=s(9820),te=s(5862),se=s(7481);const ie=e=>{let{profile:t,...s}=e;return(0,X.jsxs)(u.Dr,{sx:{width:"100%",textAlign:"start",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",minHeight:"2rem"},...s,children:[" ",(0,X.jsx)(u.Zq,{enableTranslate:!1,children:t.title})]},t.threadId)};var re=s(9479);const ne=["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-4","gpt-3.5-turbo","gpt-3.5-turbo-16k"],oe=()=>{const{t:e}=(0,M.Bd)(),[t,s]=i.useState(""),{showAlert:g}=i.useContext(se.A),[m,f]=(0,U.ok)(),v=m.get("id"),[A,w]=i.useState([]),[b,E]=i.useState(!1),[O,J]=i.useState(ne[0]),[_,V]=i.useState([]),[L,D]=i.useState(0),[G,F]=i.useState(0),[Q,H]=i.useState(!1),[K,Y]=i.useState(!1),B=(0,i.useRef)(null),$=(0,i.useRef)(null),{filteredMessages:W,setSinceTime:q,connected:z}=(0,y.dr)(x,"chatai",null!==v&&void 0!==v?v:void 0,!1,(new Date).getTime());void 0!==W&&W.length>0&&void 0!==W[0]&&A.length>0&&W[0].message===A[A.length-1].message&&W[0].role===A[A.length-1].role&&W.shift();const oe=(0,i.useMemo)((()=>(0,te.b)([...A,...W].filter((e=>void 0!==e)).sort(((e,t)=>e.createAt-t.createAt)),((e,t)=>e.message===t.message&&e.role===t.role&&e.createAt===t.createAt))),[A,W]);(0,i.useEffect)((()=>{var e;b||(null===(e=$.current)||void 0===e||e.focus())}),[b]),(0,i.useEffect)((()=>{k(G,10).then((e=>{V(e.threads),e.pageResult&&D(e.pageResult.totalPage-1)}))}),[]),(0,i.useEffect)((()=>{v?(e=>(0,h.Hd)(j+"/getChatThread",p,e))(v).then((e=>{e&&(w(e.messages),Y(e.isPubic))})).catch((e=>{g("Chat not found","error"),f({}),(0,N.yy)(e)})):w([])}),[m]),(0,i.useEffect)((()=>{var e;null===(e=B.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})}),[oe]);const ae=()=>{G<L&&k(G+1,10).then((e=>{V([..._,...e.threads]),F(G+1),e.pageResult&&D(e.pageResult.totalPage-1)}))},le=()=>{if(""===t)return;E(!0);const e=x.create();e.message=t,e.role="user",e.createAt=Date.now(),w((t=>[...t,e])),v?I(t,v,O,!z).then((e=>{"string"!==typeof e&&w((t=>[...t,e])),E(!1),s("")})):(0,h.y1)(j+"/newChatThread").then((e=>{const i=e;I(t,e,O,!z).then((e=>{"string"!==typeof e&&w((t=>[...t,e])),f({id:i}),E(!1),s("")}))}))},de=(0,i.useCallback)((async e=>{"Enter"===e.key&&(e.ctrlKey||e.shiftKey)&&(e.preventDefault(),await le())}),[t]);return(0,i.useEffect)((()=>(window.addEventListener("keydown",de),()=>{window.removeEventListener("keydown",de)})),[de]),(0,X.jsxs)(r.A,{direction:"row",justifyContent:"start",alignItems:"start",spacing:0,width:"100%",height:"89dvh",children:[(0,X.jsx)(ee.A,{up:"md",children:(0,X.jsxs)(r.A,{direction:"column",alignItems:"flex-start",height:"100%",width:"20%",minWidth:"250px",spacing:0,sx:{paddingX:"5px",overflowY:"auto",textOverflow:"ellipsis",backgroundColor:"#f1f1f1",borderRadius:"5px"},children:[(0,X.jsx)(r.A,{direction:"row",justifyContent:"center",width:"100%",paddingTop:2,children:(0,X.jsx)(u.o5,{variant:"h6",children:"Chat History"})}),(0,X.jsx)(n.A,{dense:!0,sx:{width:"100%"},children:(0,X.jsx)(re.A,{data:_,renderItem:e=>(0,X.jsxs)(r.A,{direction:"column",children:[(0,X.jsx)(ie,{profile:e,onClick:()=>{f({id:e.threadId})}},e.threadId),(0,X.jsx)(o.A,{})]},e.threadId)})}),G<L&&(0,X.jsx)(u.$n,{onClick:ae,children:"Load More"})]})}),(0,X.jsx)(ee.A,{down:"md",children:(0,X.jsx)(a.Ay,{anchor:"left",open:Q,onClose:()=>H(!1),className:"blurDialog",children:(0,X.jsxs)(r.A,{direction:"column",alignItems:"flex-start",width:"70dvw",spacing:0,sx:{padding:"20px",overflowY:"auto",textOverflow:"ellipsis"},children:[(0,X.jsxs)(r.A,{direction:"row",justifyContent:"center",width:"100%",children:[(0,X.jsx)(u.o5,{variant:"h6",flexGrow:1,children:"Chat History"}),(0,X.jsx)(l.A,{sx:{marginRight:"8px"},onClick:()=>{H(!1)},children:(0,X.jsx)(C.A,{})})]}),(0,X.jsx)(re.A,{data:[..._],renderItem:e=>(0,X.jsxs)(r.A,{direction:"column",width:"100%",children:[(0,X.jsx)(ie,{profile:e,onClick:()=>{f({id:e.threadId}),H(!1)}}),(0,X.jsx)(o.A,{})]},e.threadId)}),G<L&&(0,X.jsx)(u.$n,{onClick:ae,children:"Load More"})]})})}),(0,X.jsxs)(r.A,{direction:"column",alignItems:"flex-start",sx:{width:{xs:"100%",md:"85%"},height:"100%"},children:[(0,X.jsxs)(r.A,{direction:"row",justifyContent:"start",alignItems:"center",width:"100%",spacing:2,children:[(0,X.jsx)(ee.A,{down:"md",children:(0,X.jsx)(l.A,{"aria-label":"menu",onClick:()=>{H(!0)},sx:{justifySelf:"flex-start"},children:(0,X.jsx)(T.A,{})})}),(0,X.jsx)(d.A,{options:ne,sx:{flexGrow:1},value:O,onChange:(e,t)=>J(t),renderInput:t=>(0,X.jsx)(u.A_,{...t,label:e("Model")})}),null!==v&&v.length>0&&(0,X.jsx)(u.ip,{control:(0,X.jsx)(c.A,{checked:K,onChange:e=>{const t=e.target.checked;((e,t)=>e?(0,h.y1)(j+"/make_public",t):(0,h.y1)(j+"/make_private",t))(t,v).then((e=>{Y(t),t&&g("You can send the link of this chat to other people to let them join this chat!","success")})).catch((e=>{g(e.message,"error")}))}}),label:"Sharing"}),(0,X.jsx)(l.A,{onClick:()=>{var e;f({}),w([]),F(0),k(0,10).then((e=>{V(e.threads),e.pageResult&&D(e.pageResult.totalPage-1)})),q(Date.now()),null===(e=$.current)||void 0===e||e.focus()},children:(0,X.jsx)(S.A,{})})]}),(0,X.jsxs)(r.A,{direction:"column",alignItems:"flex-start",flexGrow:1,sx:{width:"100%"},overflow:"auto",textOverflow:"ellipsis",className:"hideScrollBar",children:[(0,X.jsx)(re.A,{data:[...oe],renderItem:(e,t)=>(0,X.jsx)(Z,{record:e,paddingX:2},t)}),(0,X.jsx)("div",{ref:B})]}),(0,X.jsxs)(r.A,{direction:"row",width:"100%",justifyContent:"center",alignItems:"flex-end",spacing:2,children:[(0,X.jsx)(P.h,{ref:$,disabled:b,className:"muiTextArea",minRows:3,style:{width:"100%",borderRadius:"0px"},value:t,onChange:e=>{s(e.target.value)},placeholder:e("Ctrl + Enter to Send a message")}),(0,X.jsx)(u.lV,{variant:"contained",endIcon:(0,X.jsx)(R.A,{}),disabled:0===t.length,loading:b,color:"inherit",disableElevation:!0,onClick:le,children:"Send"})]})]})]})},ae=i.memo(oe)}}]);
//# sourceMappingURL=307.1c52880c.chunk.js.map