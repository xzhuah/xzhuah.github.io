{"version":3,"file":"static/js/123.53339ec1.chunk.js","mappings":"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","sources":["domain/website/page/3D/DemoModel.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport {ChangeEvent, useEffect, useMemo, useRef, useState} from 'react';\r\nimport {Canvas, useFrame, useLoader, useThree} from \"@react-three/fiber\";\r\nimport {OrbitControls, useAnimations, useHelper} from \"@react-three/drei\";\r\nimport {useControls} from \"leva\";\r\nimport {MMDLoader} from \"three/examples/jsm/loaders/MMDLoader\";\r\nimport {TextField} from \"@mui/material\";\r\nimport { RapierRigidBody, RigidBody ,Physics} from '@react-three/rapier';\r\nimport {print} from \"../../../../api/util/Logging\";\r\nimport {Button} from \"../../../../component/wrapper/MuiWrappers\";\r\n// import { useBox  } from '@react-three/cannon';\r\nimport {MMDAnimationHelper} from \"three/examples/jsm/animation/MMDAnimationHelper\";\r\nimport { AmmoPhysics } from 'three/examples/jsm/physics/AmmoPhysics.js';\r\nimport * as THREE from 'three';\r\nimport {\r\n  AnimationAction,\r\n  AnimationClip, AudioLoader,\r\n  DirectionalLightHelper,\r\n  Group,\r\n  Mesh,\r\n  PointLightHelper,\r\n  Vector3\r\n} from \"three\";\r\n// import expa\r\n// import {FilePicker} from \"@mui/material\";\r\n\r\nuseLoader.preload(MMDLoader, \"/mmd/tda/Tda式初音ミクV4X_Ver1.00.pmx\");\r\n\r\ntype Props = {};\r\ntype AnimationName = 'dance' | 'blink';\r\nconst Cube = ({position, size, color}: any) => {\r\n  const ref = useRef<any>();\r\n  // delta is the time between frames, in seconds\r\n  const random_seed = Math.random();\r\n  useFrame((state, delta) => {\r\n    if (ref.current) {\r\n      ref.current.rotation.x += random_seed * delta * 2;\r\n      ref.current.rotation.y += random_seed * delta * 1.5;\r\n      ref.current.rotation.z += delta * 2;\r\n      ref.current.position.x = Math.sin(2 * random_seed * state.clock.getElapsedTime() + random_seed) * 2;\r\n      ref.current.position.z = Math.sin(state.clock.getElapsedTime() + random_seed) * 2;\r\n    }\r\n  });\r\n\r\n  return <mesh ref={ref} position={position}>\r\n    <boxGeometry args={size}/>\r\n    {/*<MeshWobbleMaterial color={color} speed={1} factor={0.6}/>*/}\r\n    <meshStandardMaterial color={color}/>\r\n  </mesh>;\r\n}\r\n\r\nconst Sphere = ({position, size, color}: any) => {\r\n  const [isHovered, setIsHovered] = React.useState(false);\r\n  const ref = useRef<any>();\r\n  // delta is the time between frames, in seconds\r\n  const random_seed = Math.random();\r\n  useFrame((state, delta) => {\r\n    if (isHovered) {\r\n      return;\r\n    }\r\n    if (ref.current) {\r\n\r\n      ref.current.position.x = Math.sin(state.clock.getElapsedTime() + random_seed * 10) * 2 * random_seed;\r\n      ref.current.position.z = Math.sin(state.clock.getElapsedTime()) * 4 * random_seed;\r\n    }\r\n  });\r\n\r\n  return <mesh ref={ref} position={position} onPointerEnter={(event) => {\r\n    setIsHovered(true);\r\n    event.stopPropagation();\r\n  }} onPointerLeave={(event) => {\r\n    setIsHovered(false);\r\n    event.stopPropagation();\r\n  }}>\r\n    <sphereGeometry args={size}/>\r\n    <meshStandardMaterial color={color} wireframe={true}/>\r\n  </mesh>;\r\n}\r\n\r\n\r\n\r\nconst MMDModelAnimation = ({ modelUrl=\"\", vmdUrl=\"\" }) => {\r\n  const modelRef = useRef(); // Reference for the model\r\n  const helperRef = useRef<MMDAnimationHelper | null>(null); // Properly typed reference for the animation helper\r\n\r\n  // const [physicsApi] = useBox(() => ({ mass: 1, position: [0, 0, 0] }));\r\n\r\n  // Load the PMX model using MMDLoader\r\n  const model = useLoader(MMDLoader, modelUrl);\r\n\r\n  useEffect(() => {\r\n    if (!model || !vmdUrl) return;\r\n\r\n    // Create a new MMDAnimationHelper instance\r\n    const helper = new MMDAnimationHelper();\r\n    helperRef.current = helper; // Assign helper to the ref\r\n\r\n    // Load the VMD file and apply it to the model\r\n    const loader = new MMDLoader();\r\n    loader.loadAnimation(vmdUrl, model, (vmd) => {\r\n      helper.add(model, { animation: vmd  as AnimationClip  });\r\n    });\r\n\r\n    // model.traverse((child) => {\r\n    //   if (child instanceof Mesh) {\r\n    //     // Apply physics to each mesh part using physicsApi\r\n    //     useBox({ mass: 1, position: [0, 0, 0] }); // Basic example\r\n    //   }\r\n    // });\r\n\r\n    // Clean up the helper when the component unmounts\r\n    return () => {\r\n      // helper.dispose();\r\n      helperRef.current = null; // Clean up the reference\r\n    };\r\n  }, [model, vmdUrl]);\r\n\r\n  // Use the helper to update animations on each frame\r\n  useFrame((_, delta) => {\r\n    if (helperRef.current) {\r\n      helperRef.current.update(delta);\r\n    }\r\n  });\r\n\r\n  return <RigidBody colliders=\"cuboid\" density={2}><primitive ref={modelRef} object={model}  dispose={null} scale={[0.25, 0.25, 0.25]}\r\n                                                              position={[0, -3, 0]} /></RigidBody>;\r\n};\r\nconst MmdModel = ({ url=\"\" }) => {\r\n  const nodes = useLoader(MMDLoader, url)\r\n  return <primitive object={nodes} dispose={null} scale={[0.25 ,0.25, 0.25]} position={[0, -3, 0]}/>\r\n}\r\n\r\n\r\ntype CameraFollowerProps = {\r\n  condition?: boolean;\r\n} & JSX.IntrinsicElements['group'];\r\n\r\nconst CameraFollower = ({\r\n                       children,\r\n                       condition = true,\r\n                       ...props\r\n                     }: CameraFollowerProps): JSX.Element  => {\r\n  const ref = useRef<Group>(null);\r\n  const [cameraPos, selfPos] = [new Vector3(), new Vector3()];\r\n\r\n  useFrame(state => {\r\n    if (!ref.current || !condition) return;\r\n\r\n    state.camera.getWorldPosition(cameraPos);\r\n    ref.current.getWorldPosition(selfPos);\r\n\r\n    ref.current.lookAt(cameraPos.x, selfPos.y, cameraPos.z);\r\n  });\r\n\r\n  return (\r\n      <group ref={ref} {...props}>\r\n        {children}\r\n      </group>\r\n  );\r\n}\r\n\r\nconst Scene = () => {\r\n  const directionalLight = useRef<any>();\r\n  const point1 = useRef<any>();\r\n  const point2 = useRef<any>();\r\n  const {lightColor, lightIntensity, lightPosition} =  useControls({\r\n    lightColor: {value: \"white\", label: \"Light Color\"},\r\n    lightIntensity: {value: 1, label: \"Light Intensity\", min:0, max:10},\r\n    lightPosition: {value: [0, 0, 2], label: \"Light Position\"}\r\n  })\r\n\r\n  const ambientLightRef = useRef<any>();\r\n  const {ambientLightColor, ambientLightIntensity} =  useControls({\r\n    ambientLightColor: {value: \"white\", label: \"Ambient Light Color\"},\r\n    ambientLightIntensity: {value: 0.4, label: \"Ambient Light Intensity\", min:0, max:10}\r\n  });\r\n\r\n  // useHelper(directionalLight, DirectionalLightHelper, 1, \"red\");\r\n  // useHelper(point1, PointLightHelper, 1, \"red\");\r\n  // useHelper(point2, PointLightHelper, 1, \"red\");\r\n  return <>\r\n\r\n    <pointLight ref={point1} color={\"purple\"} intensity={60} position={[-3, 2, -3]}/>\r\n    <pointLight ref={point2} color={\"blue\"} intensity={30} position={[3, 2, -1]}/>\r\n    <directionalLight position={lightPosition} ref={directionalLight} color={lightColor}\r\n                      intensity={lightIntensity}/>\r\n    <ambientLight intensity={ambientLightIntensity} color={ambientLightColor}\r\n                  ref={ambientLightRef}/>\r\n    {/*<MmdModel url={\"/mmd/原神-刻晴/刻晴.pmx\"}/>*/}\r\n    <Physics gravity={[0, 0, 0]} colliders={\"ball\"}>\r\n      {/*<CameraFollower condition={true}>*/}\r\n      <MMDModelAnimation modelUrl={\"/mmd/原神-刻晴/刻晴.pmx\"} vmdUrl={\"/mmd/motion/jimingyue-motion.vmd\"}/>\r\n      {/*</CameraFollower>*/}\r\n      {/*<MmdModelWithAnimation url={\"/mmd/tda/Tda式初音ミクV4X_Ver1.00.pmx\"}/>*/}\r\n    </Physics>\r\n\r\n\r\n    {/*<group position={[0, -1, 0]}>*/}\r\n    {/*  <Cube position={[1, 1, 1]} size={[1, 1, 1]} color={\"blue\"}/>*/}\r\n    {/*  <Sphere position={[-1, -1, -1]} size={[1, 30, 30]} color={\"orange\"}/>*/}\r\n    {/*  <Cube position={[-1, 1, 1]} size={[1, 1, 1]} color={\"green\"}/>*/}\r\n    {/*  <Sphere position={[1, -1, -1]} size={[1, 30, 30]} color={\"yellow\"}/>*/}\r\n    {/*</group>*/}\r\n    <OrbitControls/>\r\n  </>;\r\n}\r\n\r\n\r\nconst DemoModel = (props: Props) => {\r\n\r\n  const [audio, setAudio] = useState<any>(null);\r\n  const audioRef = useRef(null);\r\n\r\n  // Load the audio using useLoader\r\n  const audioData = useLoader(AudioLoader, '/mmd/music/寄明月.mp3');\r\n\r\n  useEffect(() => {\r\n    if (audioData) {\r\n      const sound = new THREE.Audio(new THREE.AudioListener());\r\n      sound.setBuffer(audioData);\r\n      sound.setLoop(true);\r\n      sound.setVolume(0.5);\r\n      setAudio(sound as any);\r\n    }\r\n  }, [audioData]);\r\n\r\n  useEffect(() => {\r\n    if (audio) {\r\n      audioRef.current = audio;\r\n      audio.play();\r\n    }\r\n  }, [audio]);\r\n\r\n  const handlePlay = () => {\r\n    if (audio) {\r\n      audio.play();\r\n    }\r\n  };\r\n\r\n  const handleStop = () => {\r\n    if (audio) {\r\n      audio.stop();\r\n    }\r\n  };\r\n\r\n\r\n  return <>\r\n    <Canvas className={\"threeD\"}\r\n            style={{backgroundColor: \"black\", height: \"100svh\", width: \"100wvh\"}}>\r\n      <Scene/>\r\n\r\n    </Canvas>\r\n    <button onClick={handlePlay}>Play Audio</button>\r\n    <button onClick={handleStop}>Stop Audio</button>\r\n  </>;\r\n  ;\r\n};\r\n\r\nexport default DemoModel;"],"names":["useLoader","preload","MMDLoader","MMDModelAnimation","_ref3","modelUrl","vmdUrl","modelRef","useRef","helperRef","model","useEffect","helper","MMDAnimationHelper","current","loadAnimation","vmd","add","animation","useFrame","_","delta","update","_jsx","RigidBody","colliders","density","children","ref","object","dispose","scale","position","Scene","directionalLight","point1","point2","lightColor","lightIntensity","lightPosition","useControls","value","label","min","max","ambientLightRef","ambientLightColor","ambientLightIntensity","_jsxs","_Fragment","color","intensity","Physics","gravity","OrbitControls","props","audio","setAudio","useState","audioRef","audioData","AudioLoader","sound","THREE","setBuffer","setLoop","setVolume","play","Canvas","className","style","backgroundColor","height","width","onClick","handlePlay","handleStop","stop"],"sourceRoot":""}